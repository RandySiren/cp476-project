<!DOCTYPE html>
<html>
<script src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
<body>
  
<div id="root"></div>

<script type="text/babel">
	class LoginForm extends React.Component{
		constructor(props){
			super(props);
			this.state = {error:""};		
		}
		
		getUser= (event)=>{
			this.props.username = event.target.value;
		}
		getPass= (event)=>{
			this.props.password = event.target.value;
		}
		
		checkInput= ()=>{
			let isValid=true;
			if(!this.props.password){
			console.log("Password")
				isValid=false;
				this.setState({error : "Enter a password!"})
			}
			if(!this.props.username){
			  isValid = false;
			  this.setState({error : "Enter a username!"})
			}
			else{
				var pattern = new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);
				if (!pattern.test(this.props.username)) {
				  isValid = false;
					this.setState({error : "Enter a valid email!"})				
				}
			}
			return isValid;
		}
		
		login= (event)=>{
				event.preventDefault();
		
			if(this.checkInput()){
				let self = this;
				var xhttp = new XMLHttpRequest();
				var query;
				query = `http://localhost/cp476/a4/q1/mortgage.cgi?amount=${this.props.amount}&rate=${this.props.rate}&period=${this.props.year}`
				xhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				
				xhttp.onload = function () {
					if (this.readyState == 4 && this.status == 200) {
						this.state.error=xhttp.responseText;
					}else if(this.readyState == 4 && this.status == 400){
						this.state.error = xhttp.responseText;
					}
				}

				xhttp.open("POST", query, true);
				xhttp.send(`email=${this.props.username}?password=${this.props.password}`);
			}
		}
		render(){
			return(
				<div>
                <h2>{this.state.error}</h2>
                <form onSubmit={this.login}>
                    <table>
                        <tbody>
                            <tr>
                                <td>Email</td>
                                <td><input type='text' size="10" onChange={this.getUser} /> </td>
                            </tr>
                            <tr>
                                <td>Password</td>
                                <td><input type='password' size="10" onChange={this.getPass} /> </td>
                            </tr>
                        </tbody>
                    </table>
                    <input type='submit' value='Login' />
                </form>
                </div>
			);
		}
	}
	ReactDOM.render(<LoginForm />, document.getElementById('root'));
</script>

</body>
</html>
